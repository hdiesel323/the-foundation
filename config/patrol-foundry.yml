# patrol-foundry.yml
# Foundry self-improvement patrol: detects errors and extracts reusable skills.
# Two scheduled actions at different intervals.

patrol:
  name: foundry
  description: "Self-improvement pipeline — detect errors and extract reusable skills"
  agent: daneel
  division: infrastructure
  priority: P2

  actions:
    - name: error-detector
      description: "Scan recent logs for errors and write to PostgreSQL insights table"
      schedule:
        interval: 1h
        cron: "0 * * * *"   # Every hour on the hour
      command: "skills/self-improving-agent/scripts/error-detector.sh"
      workdir: "/opt/openclaw"
      timeout: 60s

    - name: extract-skill
      description: "Extract recurring patterns into reusable skills (observe→learn→crystallize)"
      schedule:
        interval: 6h
        cron: "0 */6 * * *"   # Every 6 hours (00:00, 06:00, 12:00, 18:00 UTC)
      command: "skills/self-improving-agent/scripts/extract-skill.sh"
      workdir: "/opt/openclaw"
      timeout: 120s

  alerts:
    on_failure:
      channel: slack
      message: "WARN: foundry patrol failed — self-improvement pipeline may be stalled"
